# nbdev Project Structure Guide

## Project Overview
This is a single nbdev project with multiple submodules, following literate programming principles. Notebooks and code are co-developed, with automatic export to Python modules and documentation generation.

Do not edit files that are generated from notebooks. These are .py files that start with `# AUTOGENERATED! DO NOT EDIT! File to edit:`. If you need to edit them, you need to edit the notebook and run nbdev_export.

## Directory Structure

```
project-root/
├── settings.ini                    # Single nbdev configuration
├── _quarto.yml                     # Documentation configuration
├── nbs/                           # All notebooks (source of truth)
│   ├── submodule1/                 # Utils notebooks
│   │   ├── 001_module_name.ipynb
│   │   └── ...
│   ├── submodule2/
│   └── styles.css                # Custom documentation styles
├── package/              # Generated Python package
│   ├── _modidx.py                # Auto-generated module index
│   ├── submodule1/
│   │   ├── __init__.py           # Public API aggregator
│   │   ├── gen/                  # NBdev-generated modules
│   │   │   ├── __init__.py
│   │   │   ├── module_name.py    # From notebooks
│   │   │   └── ...
│   │   ├── __init__.py             
│   │   └── 002_module_name.py    # Normal python modules (not generated from notebooks, thus can be edited directly)
│   └── submodule2/
├── docs/                         # Generated documentation
├── .pre-commit-config.yaml       # Git hooks for notebook cleaning
└── .github/workflows/            # CI/CD automation
```

## Key Configuration Files

### settings.ini (Project Root)
- `lib_path` = package directory name
- `nbs_path` = notebooks directory (usually "nbs")  
- `doc_path` = documentation output (usually "_docs")
- `recursive = True` for submodule support

### Notebook Export Routing
- **Lib notebooks**: `#|default_exp {submodule}.gen.{module_name}`

Example in notebook first cell:
```python
#|default_exp {submodule}.gen.{module_name}
```

## API Aggregation Pattern

### Public API Exposure
Each `{submodule}` uses an aggregator pattern in `__init__.py`:

```python
# {package}/{submodule}/__init__.py`
from ..utils.nbdev_utils import reexport_into, reexport_current_dir_modules, enable_deep_module_imports_from_gen

# Load nbdev-generated modules first, then current directory modules
__all__ = []
reexport_into(__name__ + ".gen", globals(), __all__)
reexport_current_dir_modules(__name__, __file__, globals(), __all__)

# Enable deep module imports like: from package.submodule.module_name import function
enable_deep_module_imports_from_gen(__name__, __file__)
```

## Import Patterns

### Public API (Recommended)
```python
# External modules should use package-level imports
from package.submodule import function_name
```

### Internal/Development Imports
```python
# Only for internal development/testing
from package.submodule.gen.module_name import function_name
from package.submodule.module_name import function_name
```

### Notebook Organization
- Use descriptive filenames that match module names
- Start with `#|default_exp submodule.gen.module_name`
- Include comprehensive docstrings and examples
- Use `#|export` only on cells that should become public API
- Test functions immediately after definition

### Module Design
- Keep `gen/` for nbdev-generated code only
- Put manual/legacy code in `manual/` subdirectory
- Re-export public API through package `__init__.py`
- Use meaningful `__all__` declarations in modules

### Import Stability

- Always import from package level: `from package.submodule import function_name`
- Avoid deep imports: `from package.submodule.gen.module import function_name`
- Use the aggregation pattern to maintain stable public APIs
